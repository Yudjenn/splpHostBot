    let map = `{"name":"Futsal x4 River Plate ; rusito assad from HaxMaps","width":770,"height":350,"bg":{"type":"hockey","color":"959595","cornerRadius":0,"kickOffRadius":0},"vertexes":[{"x":-707.5,"y":85},{"x":-700,"y":-91.25,"bCoef":0,"cMask":["ball"]},{"x":-746.25,"y":-91.25,"bCoef":0,"cMask":["ball"]},{"x":-746.25,"y":91.25,"bCoef":0,"cMask":["ball"]},{"x":-700,"y":91.25,"bCoef":0,"cMask":["ball"]},{"x":700,"y":91.25,"bCoef":0,"cMask":["ball"]},{"x":746.25,"y":91.25,"bCoef":0,"cMask":["ball"]},{"x":746.25,"y":-91.25,"bCoef":0,"cMask":["ball"]},{"x":700,"y":-91.25,"bCoef":0,"cMask":["ball"]},{"x":-700,"y":-85,"bCoef":0.2,"cMask":["red","blue","ball"],"color":"ffffff"},{"x":-741,"y":-85,"bCoef":0.2,"cMask":["red","blue","ball"],"color":"ffffff"},{"x":-740,"y":-86,"bCoef":0.2,"cMask":["red","blue","ball"],"color":"ffffff"},{"x":-740,"y":86,"bCoef":0.2,"cMask":["red","blue","ball"],"color":"ffffff"},{"x":-741,"y":85,"bCoef":0.2,"cMask":["red","blue","ball"],"color":"ffffff"},{"x":-700,"y":85,"bCoef":0.2,"cMask":["red","blue","ball"],"color":"ffffff"},{"x":700,"y":85,"bCoef":0.2,"cMask":["red","blue","ball"],"color":"ffffff"},{"x":741,"y":85,"bCoef":0.2,"cMask":["red","blue","ball"],"color":"ffffff"},{"x":740,"y":86,"bCoef":0.2,"cMask":["red","blue","ball"],"color":"ffffff"},{"x":740,"y":-86,"bCoef":0.2,"cMask":["red","blue","ball"],"color":"ffffff"},{"x":741,"y":-85,"bCoef":0.2,"cMask":["red","blue","ball"],"color":"ffffff"},{"x":700,"y":-85,"bCoef":0.2,"cMask":["red","blue","ball"],"color":"ffffff"},{"x":-700,"y":-86,"cMask":["ball"],"color":"ff0000"},{"x":-700,"y":81,"cMask":["ball"],"color":"ff0000"},{"x":700,"y":-83,"cMask":["ball"],"color":"ff0000"},{"x":700,"y":84,"cMask":["ball"],"color":"ff0000"},{"x":-700,"y":-320,"cMask":["ball"],"color":"ffffff"},{"x":-700,"y":-85,"cMask":["ball"],"color":"ffffff"},{"x":-700,"y":85,"cMask":["ball"],"color":"ffffff"},{"x":-700,"y":320,"cMask":["ball"],"color":"ffffff"},{"x":700,"y":320,"cMask":["ball"],"color":"ffffff"},{"x":700,"y":85,"cMask":["ball"],"color":"ffffff"},{"x":700,"y":-85,"cMask":["ball"],"color":"ffffff"},{"x":700,"y":-320,"cMask":["ball"],"color":"ffffff"},{"x":-706.75,"y":-326.25,"cMask":["ball"]},{"x":-706.75,"y":-85,"cMask":["ball"]},{"x":-706.75,"y":85,"cMask":["ball"]},{"x":-706.75,"y":326.25,"cMask":["ball"]},{"x":706.75,"y":326.25,"cMask":["ball"]},{"x":706.75,"y":85,"cMask":["ball"]},{"x":706.75,"y":-85,"cMask":["ball"]},{"x":706.75,"y":-326.25,"cMask":["ball"]},{"x":-619,"y":-115,"cMask":["wall"],"color":"ffffff"},{"x":-698,"y":-115,"cMask":[],"color":"ffffff"},{"x":-619,"y":115,"cMask":["wall"],"color":"ffffff"},{"x":-698,"y":115,"cMask":[],"color":"ffffff"},{"x":619,"y":115,"cMask":["wall"],"color":"ffffff"},{"x":698,"y":115,"cMask":[],"color":"ffffff"},{"x":619,"y":-115,"cMask":["wall"],"color":"ffffff"},{"x":698,"y":-115,"cMask":[],"color":"ffffff"},{"x":385.5,"y":318,"cMask":[],"color":"ffffff"},{"x":385.5,"y":-318,"cMask":[],"color":"ffffff"},{"x":-385.5,"y":-130,"cMask":[],"color":"ffffff"},{"x":-385.5,"y":130,"cMask":[],"color":"ffffff"},{"x":385.5,"y":130,"cMask":[],"color":"ffffff"},{"x":385.5,"y":-130,"cMask":[],"color":"ffffff"},{"x":0,"y":-350,"bCoef":0.1,"cMask":["red","blue"],"cGroup":["redKO","blueKO"]},{"x":0,"y":-110,"bCoef":0.1,"cMask":["red","blue"],"cGroup":["redKO","blueKO"],"color":"000000"},{"x":0,"y":110,"bCoef":0.1,"cMask":["red","blue"],"cGroup":["redKO","blueKO"],"color":"000000","curve":0},{"x":0,"y":350,"bCoef":0.1,"cMask":["red","blue"],"cGroup":["redKO","blueKO"],"curve":0},{"x":-15,"y":-90,"cMask":["wall"],"curve":165},{"x":-15,"y":90,"cMask":["wall"],"curve":165},{"x":-15,"y":-52.5,"cMask":["wall"],"curve":-145},{"x":-15,"y":52.5,"cMask":["wall"],"curve":150},{"x":-40,"y":40,"cMask":["wall"],"curve":-145},{"x":-40,"y":22.5,"cMask":["wall"],"curve":102.5},{"x":-47.5,"y":5,"cMask":["wall"],"curve":55},{"x":-27.5,"y":5,"cMask":["wall"]},{"x":-27.5,"y":47.5,"cMask":["wall"]},{"x":-47,"y":-7.5,"cMask":["wall"],"curve":80},{"x":-27.5,"y":-35,"cMask":["wall"],"curve":102.5},{"x":-27.5,"y":-7.5,"cMask":["wall"]},{"x":0,"y":-91,"cMask":["wall"],"curve":30},{"x":0,"y":90,"cMask":["wall"],"curve":65},{"x":31.5,"y":-91,"cMask":["wall"],"curve":60},{"x":43.5,"y":-70,"cMask":["wall"],"curve":5},{"x":43.5,"y":-10,"cMask":["wall"],"curve":55},{"x":30,"y":10,"cMask":["wall"],"curve":10},{"x":50,"y":75.5,"cMask":["wall"],"curve":10},{"x":37.5,"y":85,"cMask":["wall"],"curve":11},{"x":16.5,"y":22.5,"cMask":["wall"]},{"x":16.5,"y":90,"cMask":["wall"],"curve":20},{"x":15,"y":-2.5,"cMask":["wall"],"curve":85},{"x":15,"y":-70,"cMask":["wall"],"curve":20},{"x":30,"y":-65,"cMask":["wall"],"curve":0},{"x":30,"y":-12.5,"cMask":["wall"],"curve":-60},{"x":60,"y":-70,"cMask":["wall"]},{"x":60,"y":70,"cMask":["wall"]},{"x":75,"y":53,"cMask":["wall"]},{"x":75,"y":25,"cMask":["wall"],"curve":-105},{"x":77.5,"y":-55,"cMask":["wall"],"curve":-105},{"x":74,"y":-38,"cMask":["wall"],"curve":120},{"x":74,"y":5,"cMask":["wall"],"curve":120},{"x":-15,"y":-87,"cMask":["wall"],"curve":165},{"x":-15,"y":87,"cMask":["wall"],"curve":165},{"x":-15,"y":-84,"cMask":["wall"],"curve":165},{"x":-15,"y":84,"cMask":["wall"],"curve":165},{"x":-15,"y":-81,"cMask":["wall"],"curve":165},{"x":-15,"y":81,"cMask":["wall"],"curve":165},{"x":-15,"y":-78,"cMask":["wall"],"curve":165},{"x":-15,"y":78,"cMask":["wall"],"curve":165},{"x":-15,"y":-75,"cMask":["wall"],"curve":165},{"x":-15,"y":75,"cMask":["wall"],"curve":165},{"x":-15,"y":-72,"cMask":["wall"],"curve":165},{"x":-15,"y":72,"cMask":["wall"],"curve":165},{"x":-15,"y":-70,"cMask":["wall"],"curve":165},{"x":-15,"y":70,"cMask":["wall"],"curve":165},{"x":-17.5,"y":-52.5,"cMask":["wall"],"curve":-145},{"x":-17.5,"y":51,"cMask":["wall"],"curve":150},{"x":-20,"y":-52.5,"cMask":["wall"],"curve":-145},{"x":-20,"y":51,"cMask":["wall"],"curve":150},{"x":-22.5,"y":-52.5,"cMask":["wall"],"curve":-145},{"x":-22.5,"y":50,"cMask":["wall"],"curve":150},{"x":-25,"y":-51,"cMask":["wall"],"curve":-145},{"x":-25,"y":49,"cMask":["wall"],"curve":150},{"x":-27.5,"y":-50,"cMask":["wall"],"curve":-145},{"x":-27.5,"y":48,"cMask":["wall"],"curve":150},{"x":-15,"y":-50,"cMask":["wall"],"curve":-145},{"x":-40,"y":37,"cMask":["wall"],"curve":-145},{"x":-15,"y":-47,"cMask":["wall"],"curve":-145},{"x":-40,"y":34,"cMask":["wall"],"curve":-145},{"x":-15,"y":-44,"cMask":["wall"],"curve":-145},{"x":-40,"y":31,"cMask":["wall"],"curve":-145},{"x":-15,"y":-41,"cMask":["wall"],"curve":-145},{"x":-40,"y":28,"cMask":["wall"],"curve":-145},{"x":-15,"y":-38,"cMask":["wall"],"curve":-145},{"x":-40,"y":25,"cMask":["wall"],"curve":-145},{"x":-47.5,"y":2.5,"cMask":["wall"],"curve":55},{"x":-27.5,"y":2.5,"cMask":["wall"]},{"x":-47.5,"y":0,"cMask":["wall"],"curve":55},{"x":-27.5,"y":0,"cMask":["wall"]},{"x":-47.5,"y":-2.5,"cMask":["wall"],"curve":55},{"x":-27.5,"y":-2.5,"cMask":["wall"]},{"x":-47.5,"y":-5,"cMask":["wall"],"curve":55},{"x":-27.5,"y":-5,"cMask":["wall"]},{"x":62.5,"y":-67.5,"cMask":["wall"]},{"x":62.5,"y":67.5,"cMask":["wall"]},{"x":65,"y":-65,"cMask":["wall"]},{"x":65,"y":65,"cMask":["wall"]},{"x":67.5,"y":-62.5,"cMask":["wall"]},{"x":67.5,"y":62.5,"cMask":["wall"]},{"x":70,"y":-60,"cMask":["wall"]},{"x":70,"y":59,"cMask":["wall"]},{"x":72.5,"y":-60,"cMask":["wall"]},{"x":72.5,"y":56,"cMask":["wall"]},{"x":73.999,"y":-56,"cMask":["wall"]},{"x":73.999,"y":50,"cMask":["wall"]},{"x":75,"y":22.5,"cMask":["wall"],"curve":-105},{"x":75,"y":-55,"cMask":["wall"],"curve":-105},{"x":75,"y":19,"cMask":["wall"],"curve":-105},{"x":75,"y":-52,"cMask":["wall"],"curve":-105},{"x":75,"y":16,"cMask":["wall"],"curve":-105},{"x":75,"y":-49,"cMask":["wall"],"curve":-105},{"x":75,"y":13,"cMask":["wall"],"curve":-105},{"x":75,"y":-46,"cMask":["wall"],"curve":-105},{"x":75,"y":-41,"cMask":["wall"],"curve":110},{"x":75,"y":8,"cMask":["wall"],"curve":110},{"x":75,"y":-44,"cMask":["wall"],"curve":100},{"x":75,"y":11,"cMask":["wall"],"curve":100},{"x":2.5,"y":-88.5,"cMask":["wall"],"curve":0},{"x":2.5,"y":87.5,"cMask":["wall"],"curve":20},{"x":31.5,"y":-88.5,"cMask":["wall"],"curve":60},{"x":41,"y":-70,"cMask":["wall"],"curve":0},{"x":41,"y":-10,"cMask":["wall"],"curve":55},{"x":27.5,"y":10,"cMask":["wall"],"curve":10},{"x":47.5,"y":75.5,"cMask":["wall"],"curve":10},{"x":37.5,"y":81,"cMask":["wall"]},{"x":16.5,"y":20,"cMask":["wall"]},{"x":16.5,"y":87.5,"cMask":["wall"],"curve":20},{"x":5,"y":-86,"cMask":["wall"]},{"x":5,"y":85,"cMask":["wall"],"curve":20},{"x":31.5,"y":-86,"cMask":["wall"],"curve":60},{"x":38.5,"y":-70,"cMask":["wall"],"curve":5},{"x":38.5,"y":-10,"cMask":["wall"],"curve":55},{"x":25,"y":10,"cMask":["wall"],"curve":10},{"x":45,"y":75.5,"cMask":["wall"],"curve":10},{"x":37.5,"y":77,"cMask":["wall"]},{"x":16.5,"y":17.5,"cMask":["wall"]},{"x":16.5,"y":85,"cMask":["wall"],"curve":20},{"x":7.5,"y":-83.5,"cMask":["wall"]},{"x":7.5,"y":82.5,"cMask":["wall"],"curve":20},{"x":31.5,"y":-83.5,"cMask":["wall"],"curve":60},{"x":36,"y":-70,"cMask":["wall"],"curve":5},{"x":36,"y":-10,"cMask":["wall"],"curve":55},{"x":22.5,"y":10,"cMask":["wall"],"curve":10},{"x":42.5,"y":75.5,"cMask":["wall"],"curve":10},{"x":37.5,"y":73,"cMask":["wall"]},{"x":16.5,"y":15,"cMask":["wall"]},{"x":16.5,"y":82.5,"cMask":["wall"],"curve":20},{"x":10,"y":-81,"cMask":["wall"]},{"x":10,"y":80,"cMask":["wall"],"curve":20},{"x":31.5,"y":-81,"cMask":["wall"],"curve":60},{"x":33.5,"y":-70,"cMask":["wall"],"curve":5},{"x":33.5,"y":-10,"cMask":["wall"],"curve":20},{"x":20,"y":10,"cMask":["wall"],"curve":75},{"x":40,"y":75.5,"cMask":["wall"],"curve":10},{"x":37.5,"y":69,"cMask":["wall"]},{"x":16.5,"y":12.5,"cMask":["wall"],"curve":20},{"x":16.5,"y":80,"cMask":["wall"],"curve":65},{"x":15,"y":-91,"cMask":["wall"],"curve":0},{"x":15,"y":90,"cMask":["wall"],"curve":0},{"x":12.5,"y":-91,"cMask":["wall"],"curve":-10},{"x":12.5,"y":90,"cMask":["wall"],"curve":0},{"x":31,"y":-91,"cMask":["wall"],"curve":0},{"x":31,"y":10,"cMask":["wall"],"curve":5},{"x":-385.5,"y":318,"cMask":[],"color":"ffffff"},{"x":-385.5,"y":-318,"cMask":[],"color":"ffffff"},{"cMask":["wall"],"x":0,"y":-112.5,"curve":180},{"cMask":["wall"],"x":0,"y":112.5,"curve":180},{"cMask":["wall"],"x":0,"y":320},{"cMask":["wall"],"x":0,"y":-320},{"cMask":["wall"],"x":-700,"y":-25,"color":"b00000"},{"cMask":["wall"],"x":-700,"y":25,"color":"b00000"},{"cMask":["wall"],"x":700,"y":-25,"color":"b00000"},{"cMask":["wall"],"x":700,"y":25,"color":"b00000"},{"cMask":["wall"],"x":-480,"y":-4,"curve":120},{"cMask":["wall"],"x":-480,"y":4,"curve":120},{"cMask":["wall"],"x":480,"y":-4,"curve":120},{"cMask":["wall"],"x":480,"y":4,"curve":120},{"x":-707.25,"y":85,"cMask":["ball"]},{"x":-707.25,"y":326.25,"cMask":["ball"]},{"x":707.25,"y":85,"cMask":["ball"]},{"x":707.25,"y":326.25,"cMask":["ball"]},{"x":-707.25,"y":-326.25,"cMask":["ball"]},{"x":-707.25,"y":-85,"cMask":["ball"]},{"x":707.25,"y":-326.25,"cMask":["ball"]},{"x":707.25,"y":-85,"cMask":["ball"]}],"segments":[{"v0":1,"v1":2,"vis":false,"bCoef":0,"cMask":["ball"]},{"v0":2,"v1":3,"vis":false,"bCoef":0,"cMask":["ball"]},{"v0":3,"v1":4,"vis":false,"bCoef":0,"cMask":["ball"]},{"v0":5,"v1":6,"vis":false,"bCoef":0,"cMask":["ball"]},{"v0":6,"v1":7,"vis":false,"bCoef":0,"cMask":["ball"]},{"v0":7,"v1":8,"vis":false,"bCoef":0,"cMask":["ball"]},{"v0":9,"v1":10,"color":"ffffff","bCoef":0.2,"cMask":["red","blue","ball"]},{"v0":11,"v1":12,"color":"ffffff","bCoef":0.2,"cMask":["red","blue","ball"]},{"v0":13,"v1":14,"color":"ffffff","bCoef":0.2,"cMask":["red","blue","ball"]},{"v0":15,"v1":16,"color":"ffffff","bCoef":0.2,"cMask":["red","blue","ball"]},{"v0":17,"v1":18,"color":"ffffff","bCoef":0.2,"cMask":["red","blue","ball"]},{"v0":19,"v1":20,"color":"ffffff","bCoef":0.2,"cMask":["red","blue","ball"]},{"v0":21,"v1":22,"color":"ff0000","cMask":[]},{"v0":23,"v1":24,"color":"ff0000","cMask":[]},{"v0":25,"v1":26,"color":"ffffff","cMask":["ball"]},{"v0":27,"v1":28,"color":"ffffff","cMask":["ball"]},{"v0":29,"v1":30,"color":"ffffff","cMask":["ball"]},{"v0":31,"v1":32,"color":"ffffff","cMask":["ball"]},{"v0":33,"v1":34,"vis":false,"cMask":["ball"],"x":-706.75},{"v0":35,"v1":36,"vis":false,"cMask":["ball"],"x":-706.75},{"v0":37,"v1":38,"vis":false,"cMask":["ball"],"x":706.75},{"v0":39,"v1":40,"vis":false,"cMask":["ball"],"x":706.75},{"v0":41,"v1":42,"color":"ffffff","cMask":[]},{"v0":43,"v1":44,"color":"ffffff","cMask":[]},{"v0":45,"v1":46,"color":"ffffff","cMask":[]},{"v0":47,"v1":48,"color":"ffffff","cMask":[]},{"v0":49,"v1":50,"color":"ffffff","cMask":[]},{"v0":51,"v1":52,"curve":89.99999999999999,"color":"ffffff","cMask":[],"curveF":1.0000000000000002},{"v0":53,"v1":54,"curve":89.99999999999999,"color":"ffffff","cMask":[],"curveF":1.0000000000000002},{"v0":55,"v1":56,"vis":false,"cMask":["red","blue"],"cGroup":["redKO","blueKO"]},{"v0":57,"v1":58,"vis":false,"cMask":["red","blue"],"cGroup":["redKO","blueKO"],"curve":0},{"v0":56,"v1":57,"curve":180,"color":"000000","cMask":["red","blue"],"cGroup":["redKO"],"curveF":6.123233995736766e-17},{"v0":57,"v1":56,"curve":180,"color":"000000","cMask":["red","blue"],"cGroup":["blueKO"],"curveF":6.123233995736766e-17},{"v0":60,"v1":59,"curve":165,"color":"000000","cMask":["wall"]},{"v0":61,"v1":62,"curve":0,"color":"000000","cMask":["wall"],"x":-15},{"v0":61,"v1":63,"curve":-145,"color":"000000","cMask":["wall"]},{"v0":63,"v1":64,"curve":0,"color":"000000","cMask":["wall"]},{"v0":64,"v1":65,"curve":55,"color":"000000","cMask":["wall"]},{"v0":65,"v1":66,"curve":0,"color":"000000","cMask":["wall"],"y":5},{"v0":66,"v1":67,"curve":0,"color":"000000","cMask":["wall"],"x":-27.5},{"v0":67,"v1":62,"curve":0,"color":"000000","cMask":["wall"]},{"v0":68,"v1":69,"curve":80,"color":"000000","cMask":["wall"]},{"v0":69,"v1":70,"color":"000000","cMask":["wall"]},{"v0":70,"v1":68,"color":"000000","cMask":["wall"],"y":-7.5},{"v0":71,"v1":72,"color":"000000","cMask":["wall"],"x":0},{"v0":71,"v1":73,"color":"000000","cMask":["wall"]},{"v0":73,"v1":74,"curve":60,"color":"000000","cMask":["wall"]},{"v0":74,"v1":75,"curve":5,"color":"000000","cMask":["wall"],"x":43.5},{"v0":75,"v1":76,"curve":55,"color":"000000","cMask":["wall"]},{"v0":76,"v1":77,"curve":10,"color":"000000","cMask":["wall"]},{"v0":77,"v1":78,"color":"000000","cMask":["wall"]},{"v0":78,"v1":79,"color":"000000","cMask":["wall"]},{"v0":79,"v1":80,"color":"000000","cMask":["wall"],"x":16.5},{"v0":80,"v1":72,"curve":20,"color":"000000","cMask":["wall"],"y":90},{"v0":81,"v1":82,"curve":0,"color":"000000","cMask":["wall"],"x":15},{"v0":82,"v1":83,"curve":60,"color":"000000","cMask":["wall"]},{"v0":83,"v1":84,"curve":0,"color":"000000","cMask":["wall"],"x":30},{"v0":81,"v1":84,"curve":-60,"color":"000000","cMask":["wall"]},{"v0":85,"v1":86,"curve":0,"color":"000000","cMask":["wall"],"x":60},{"v0":86,"v1":87,"curve":0,"color":"000000","cMask":["wall"]},{"v0":87,"v1":88,"curve":0,"color":"000000","cMask":["wall"],"x":75},{"v0":88,"v1":89,"curve":-105,"color":"000000","cMask":["wall"]},{"v0":89,"v1":85,"curve":0,"color":"000000","cMask":["wall"]},{"v0":90,"v1":91,"curve":120,"color":"000000","cMask":["wall"],"x":74},{"v0":93,"v1":92,"curve":165,"color":"000000","cMask":["wall"]},{"v0":95,"v1":94,"curve":165,"color":"000000","cMask":["wall"]},{"v0":97,"v1":96,"curve":165,"color":"000000","cMask":["wall"]},{"v0":99,"v1":98,"curve":165,"color":"000000","cMask":["wall"]},{"v0":101,"v1":100,"curve":165,"color":"000000","cMask":["wall"]},{"v0":103,"v1":102,"curve":165,"color":"000000","cMask":["wall"]},{"v0":105,"v1":104,"curve":165,"color":"000000","cMask":["wall"]},{"v0":106,"v1":107,"curve":0,"color":"000000","cMask":["wall"],"x":-17.5},{"v0":108,"v1":109,"curve":0,"color":"000000","cMask":["wall"],"x":-20},{"v0":110,"v1":111,"curve":0,"color":"000000","cMask":["wall"],"x":-22.5},{"v0":112,"v1":113,"curve":0,"color":"000000","cMask":["wall"],"x":-25},{"v0":114,"v1":115,"curve":0,"color":"000000","cMask":["wall"],"x":-27.5},{"v0":116,"v1":117,"curve":-145,"color":"000000","cMask":["wall"]},{"v0":118,"v1":119,"curve":-145,"color":"000000","cMask":["wall"]},{"v0":120,"v1":121,"curve":-145,"color":"000000","cMask":["wall"]},{"v0":122,"v1":123,"curve":-145,"color":"000000","cMask":["wall"]},{"v0":124,"v1":125,"curve":-145,"color":"000000","cMask":["wall"]},{"v0":125,"v1":69,"curve":121.72228383638827,"color":"000000","cMask":["wall"]},{"v0":121,"v1":120,"curve":114.05739397855167,"color":"000000","cMask":["wall"]},{"v0":64,"v1":69,"curve":102.5,"cMask":["wall"]},{"v0":126,"v1":127,"curve":0,"color":"000000","cMask":["wall"],"y":2.5},{"v0":128,"v1":129,"curve":0,"color":"000000","cMask":["wall"],"y":0},{"v0":130,"v1":131,"curve":0,"color":"000000","cMask":["wall"],"y":-2.5},{"v0":132,"v1":133,"curve":0,"color":"000000","cMask":["wall"],"y":-5},{"v0":134,"v1":135,"curve":0,"color":"000000","cMask":["wall"],"x":62.5},{"v0":136,"v1":137,"curve":0,"color":"000000","cMask":["wall"],"x":65},{"v0":138,"v1":139,"curve":0,"color":"000000","cMask":["wall"],"x":67.5},{"v0":140,"v1":141,"curve":0,"color":"000000","cMask":["wall"],"x":70},{"v0":142,"v1":143,"curve":0,"color":"000000","cMask":["wall"],"x":72.5},{"v0":144,"v1":145,"curve":0,"color":"000000","cMask":["wall"],"x":73.999},{"v0":146,"v1":147,"curve":-105,"color":"000000","cMask":["wall"]},{"v0":148,"v1":149,"curve":-105,"color":"000000","cMask":["wall"]},{"v0":150,"v1":151,"curve":-105,"color":"000000","cMask":["wall"]},{"v0":152,"v1":153,"curve":-105,"color":"000000","cMask":["wall"]},{"v0":154,"v1":155,"curve":110,"color":"000000","cMask":["wall"],"x":75},{"v0":156,"v1":157,"curve":100,"color":"000000","cMask":["wall"],"x":75},{"v0":158,"v1":159,"color":"000000","cMask":["wall"],"x":2.5},{"v0":158,"v1":160,"color":"000000","cMask":["wall"],"y":-88.5},{"v0":160,"v1":161,"curve":60,"color":"000000","cMask":["wall"]},{"v0":161,"v1":162,"curve":5,"color":"000000","cMask":["wall"],"x":41},{"v0":162,"v1":163,"curve":55,"color":"000000","cMask":["wall"]},{"v0":163,"v1":164,"curve":10,"color":"000000","cMask":["wall"]},{"v0":164,"v1":165,"color":"000000","cMask":["wall"]},{"v0":165,"v1":166,"color":"000000","cMask":["wall"]},{"v0":166,"v1":167,"color":"000000","cMask":["wall"],"x":16.5},{"v0":167,"v1":159,"curve":20,"color":"000000","cMask":["wall"],"y":87.5},{"v0":168,"v1":169,"color":"000000","cMask":["wall"],"x":5},{"v0":168,"v1":170,"color":"000000","cMask":["wall"],"y":-86},{"v0":170,"v1":171,"curve":60,"color":"000000","cMask":["wall"]},{"v0":171,"v1":172,"curve":5,"color":"000000","cMask":["wall"],"x":38.5},{"v0":172,"v1":173,"curve":55,"color":"000000","cMask":["wall"]},{"v0":173,"v1":174,"curve":10,"color":"000000","cMask":["wall"]},{"v0":174,"v1":175,"color":"000000","cMask":["wall"]},{"v0":175,"v1":176,"color":"000000","cMask":["wall"]},{"v0":176,"v1":177,"color":"000000","cMask":["wall"],"x":16.5},{"v0":177,"v1":169,"curve":20,"color":"000000","cMask":["wall"],"y":85},{"v0":178,"v1":179,"color":"000000","cMask":["wall"],"x":7.5},{"v0":178,"v1":180,"color":"000000","cMask":["wall"],"y":-83.5},{"v0":180,"v1":181,"curve":60,"color":"000000","cMask":["wall"]},{"v0":181,"v1":182,"curve":5,"color":"000000","cMask":["wall"],"x":36},{"v0":182,"v1":183,"curve":55,"color":"000000","cMask":["wall"]},{"v0":183,"v1":184,"curve":10,"color":"000000","cMask":["wall"]},{"v0":184,"v1":185,"curve":63.47913661534058,"color":"000000","cMask":["wall"]},{"v0":185,"v1":186,"color":"000000","cMask":["wall"]},{"v0":186,"v1":187,"color":"000000","cMask":["wall"],"x":16.5},{"v0":187,"v1":179,"curve":20,"color":"000000","cMask":["wall"],"y":82.5},{"v0":188,"v1":189,"color":"000000","cMask":["wall"],"x":10},{"v0":188,"v1":190,"color":"000000","cMask":["wall"],"y":-81},{"v0":190,"v1":191,"curve":60,"color":"000000","cMask":["wall"]},{"v0":191,"v1":192,"curve":5,"color":"000000","cMask":["wall"],"x":33.5},{"v0":192,"v1":193,"curve":55,"color":"000000","cMask":["wall"]},{"v0":193,"v1":194,"curve":10,"color":"000000","cMask":["wall"]},{"v0":194,"v1":195,"color":"000000","cMask":["wall"]},{"v0":195,"v1":196,"color":"000000","cMask":["wall"]},{"v0":196,"v1":197,"color":"000000","cMask":["wall"],"x":16.5},{"v0":197,"v1":189,"curve":20,"color":"000000","cMask":["wall"],"y":80},{"v0":81,"v1":78,"curve":11,"color":"000000","cMask":["wall"]},{"v0":81,"v1":165,"curve":-10.143641024858274,"color":"000000","cMask":["wall"]},{"v0":198,"v1":199,"curve":0,"color":"000000","cMask":["wall"],"x":15},{"v0":200,"v1":201,"curve":0,"color":"000000","cMask":["wall"],"x":12.5},{"v0":193,"v1":192,"curve":0.5,"color":"000000","cMask":["wall"]},{"v0":81,"v1":192,"curve":-30,"cMask":["wall"]},{"v0":81,"v1":192,"curve":-87,"cMask":["wall"]},{"v0":81,"v1":193,"curve":85,"cMask":["wall"]},{"v0":193,"v1":192,"curve":75,"cMask":["wall"]},{"v0":196,"v1":192,"curve":20,"cMask":["wall"]},{"v0":202,"v1":203,"curve":5,"color":"000000","cMask":["wall"],"x":31},{"v0":72,"v1":197,"curve":65,"color":"000000","cMask":["wall"]},{"v0":82,"v1":71,"curve":-47,"color":"000000","cMask":["wall"]},{"v0":82,"v1":161,"curve":20,"color":"000000","cMask":["wall"]},{"v0":161,"v1":71,"curve":80,"color":"000000","cMask":["wall"]},{"v0":83,"v1":202,"curve":0,"color":"000000","cMask":["wall"]},{"v0":158,"v1":161,"curve":-55,"color":"000000","cMask":["wall"]},{"v0":161,"v1":71,"curve":30,"color":"000000","cMask":["wall"]},{"v0":200,"v1":161,"curve":-10,"color":"000000","cMask":["wall"]},{"v0":161,"v1":158,"curve":0,"color":"000000","cMask":["wall"]},{"v0":204,"v1":205,"color":"ffffff","cMask":[],"x":-385.5},{"color":"ffffff","v0":41,"v1":43,"cMask":["wall"]},{"color":"ffffff","v0":45,"v1":47,"cMask":["wall"]},{"curve":180,"color":"000000","cMask":["wall"],"v0":206,"v1":207,"x":0},{"curve":180,"color":"000000","cMask":["wall"],"v0":207,"v1":206,"x":0},{"curve":0,"color":"000000","cMask":["wall"],"v0":207,"v1":208,"x":0},{"curve":0,"color":"000000","cMask":["wall"],"v0":206,"v1":209},{"color":"b00000","cMask":["wall"],"v0":210,"v1":211,"x":-700},{"color":"b00000","cMask":["wall"],"v0":212,"v1":213,"x":700},{"color":"ffffff","cMask":["ball"],"v0":25,"v1":32,"y":-320},{"color":"ffffff","cMask":["ball"],"v0":28,"v1":29,"y":320},{"color":"ffffff","cMask":["wall"],"v0":214,"v1":215},{"color":"ffffff","cMask":["wall"],"v0":215,"v1":214,"curve":120},{"color":"ffffff","cMask":["wall"],"v0":214,"v1":215,"curve":120},{"color":"ffffff","cMask":["wall"],"v0":215,"v1":214,"curve":180},{"color":"ffffff","cMask":["wall"],"v0":214,"v1":215,"curve":180},{"color":"ffffff","cMask":["wall"],"v0":216,"v1":217,"x":480},{"color":"ffffff","cMask":["wall"],"v0":217,"v1":216,"curve":120,"x":480},{"color":"ffffff","cMask":["wall"],"v0":216,"v1":217,"curve":120,"x":480},{"color":"ffffff","cMask":["wall"],"v0":217,"v1":216,"curve":180,"x":480},{"color":"ffffff","cMask":["wall"],"v0":216,"v1":217,"curve":180,"x":480},{"v0":218,"v1":219,"vis":false,"cMask":["ball"],"x":-707.25},{"v0":220,"v1":221,"vis":false,"cMask":["ball"],"x":707.25},{"v0":222,"v1":223,"vis":false,"cMask":["ball"],"x":-707.25},{"v0":224,"v1":225,"vis":false,"cMask":["ball"],"x":707.25}],"planes":[{"normal":[0,1],"dist":-350,"bCoef":0.1},{"normal":[0,-1],"dist":-352,"bCoef":0.1},{"normal":[-1,0],"dist":-385,"bCoef":0,"cMask":["c1"]},{"normal":[1,0],"dist":-385,"bCoef":0,"cMask":["c0"]},{"normal":[1,0],"dist":-770,"bCoef":0.1},{"normal":[-1,0],"dist":-770,"bCoef":0.1},{"cMask":["ball"],"dist":-326,"normal":[0,-1]},{"cMask":["ball"],"dist":-326,"normal":[0,1]}],"goals":[{"p0":[-708.25,-85],"p1":[-708.25,85],"team":"red"},{"p0":[708.25,85],"p1":[708.25,-85],"team":"blue"}],"discs":[{"radius":6.25,"invMass":1.5,"pos":[0,0],"color":"E68F00","bCoef":0.4,"cGroup":["ball","kick","score"]},{"radius":5.4,"invMass":0,"pos":[-700,85],"color":"ff0000"},{"radius":5.4,"invMass":0,"pos":[-700,-85],"color":"ff0000"},{"radius":5.4,"invMass":0,"pos":[700,85],"color":"ff0000"},{"radius":5.4,"invMass":0,"pos":[700,-85],"color":"ff0000"}],"playerPhysics":{"bCoef":0,"acceleration":0.11,"kickingAcceleration":0.083},"ballPhysics":"disc0","spawnDistance":350,"traits":{"rusito":{"color":"444749"},"assad":{"color":"444749"}},"joints":[],"redSpawnPoints":[],"blueSpawnPoints":[],"canBeStored":false}`

const HaxballJS = require("haxball.js");
const { Client, GatewayIntentBits } = require('discord.js');
var fs = require('fs');

const client = new Client({ intents: [GatewayIntentBits.Guilds] });

const sendDisc = (message) => {
    const channel = client.channels.cache.get('1165230703101878275');
    channel.send(message)
}

const sendDiscFile = (message) => {
    const channel = client.channels.cache.get('1165230703101878275');
    message.channel.send("Testing message.", {
        files: [
            './myOutput.txt'
        ]
    });
}

client.on('ready', () => {
    console.log(`Logged in as ${client.user.tag}!`);
    sendDisc('ready')
});

HaxballJS.then((HBInit) => {
  // ---------- ROOM CONFIG ----------

    geo = {'code': 'eu', 'lat': 50, 'lon': 0}
    var room = HBInit({
	    roomName: 'Statville Premier League',
	    maxPlayers: 16,
	    noPlayer: true, // remove host player
        public: false,
        token: 'thr1.AAAAAGU_8An0WWGIAS68aw.gqK5k76gq_E',
        geo
    });

    room.setCustomStadium(map)
    room.setScoreLimit(0)
    room.setTimeLimit(10)
    room.setPassword("SPL")

    room.onPlayerJoin = function(player) {
        admins = ['Yura', 'vvv', 'topof', 'TNAssassin', 'comrade', 'nova', 'TheBoltonKing', 'Percy'] // all of bod
        player.name == 'Yura' || player.name == 'vvv' || player.name == 'topof' || player.name == 'TNAssassin' || player.name == 'comrade' || player.name == 'nova' || player.name == 'TheBoltonKing' || player.name == 'Percy' ? room.setPlayerAdmin(player.id, true) : room.setPlayerAdmin(player.id, false)
    }

    // ---------- END OF ROOM CONFIG ----------

    // ---------- VARS ----------

    let assister = undefined
    let goalscorer = undefined
    let poss = [0, 0]
    let kicks = [0, 0]
    let goals = [0, 0]

    // ---------- END OF VARS ----------

    room.onPlayerChat = function(player, message) {
        sendDisc(player + ' sent: ' + message)
        if (message.toLowerCase == '!swap') {
            var players = room.getPlayerList()
            for (let i = 0; i < players.length; i++) {
                if (players[i].team == 1) {
                    room.setPlayerTeam(players[i].id, 2)
                }
                if (players[i].team == 2) {
                    room.setPlayerTeam(players[i].id, 1)
                }
            }
        }

        if (message.includes('!set home team')) {
            const output = message.split(' ')
            output[3].toLowerCase == 'atl' ? room.setTeamColors(1, 60, 0x000000, [0xFF1F1F, 0xFFDD00, 0xFF0000]) : {}
            output[3].toLowerCase == 'ols' ? room.setTeamColors(1, 60, 0x36FFFF, [0x264E92, 0xE8CC17]) : {}
            output[3].toLowerCase == 'ftn' ? room.sendAnnouncement('i dont have these kits brother 😔') : {}
            output[3].toLowerCase == 'acs' ? room.sendAnnouncement('i dont have these kits brother 😔') : {}
            output[3].toLowerCase == 'cmt' ? room.sendAnnouncement('i dont have these kits brother 😔') : {}
            output[3].toLowerCase == 'cnt' ? room.sendAnnouncement('i dont have these kits brother 😔') : {}
            output[3].toLowerCase == 'ars' ? room.sendAnnouncement('i dont have these kits brother 😔') : {}
            output[3].toLowerCase == 'efc' ? room.sendAnnouncement('i dont have these kits brother 😔') : {}
        }

        if (message.toLowerCase == '!bb') {
            room.kickPlayer(player.id, 'goodbye, now join the discord: https://discord.gg/cx9WWA84dv')
        }

        if (message.toLowerCase == '!discord') {
            room.sendAnnouncement('join our discord server here: https://discord.gg/cx9WWA84dv')
        }

        if (message.charAt(0) != '!') {
            player.admin ? room.sendAnnouncement('[ADMIN] ' + player.name + ': ' + message, null, 0xFFFF00, 'bold') : room. sendAnnouncement('(Player) ' + player.name + ': ' + message)
        }

        return false;
    }

    room.onGameStart = function() {
        room.startRecording()
    }

    room.onGameStop = function() {
        var file = fs.createWriteStream('myOutput.txt');
        file.write('Hello world!\n');
        file.write('Another line\n');
        file.end();
        sendDiscFile();
    }

    room.onPlayerBallKick = function(player) {
        assister = goalscorer
        goalscorer = player
        player.team == 1 ? kicks[0]++ : kicks[1]++
    }

    room.onTeamGoal = function(team) {
        if (assister == undefined || assister == goalscorer) {
            if (goalscorer.team == team) {
                room.sendAnnouncement('⚽️ | Goal scored by ' + goalscorer.name, null, 0xFF0000, 'bold')
            } else {
                room.sendAnnouncement('😔 | Broski ' + goalscorer.name + ' be scorin a own goal', null, 0xFF0000, 'bold')
            }
        } else {
            if (goalscorer.team == team) {
                room.sendAnnouncement('⚽️ | Goal scored by ' + goalscorer.name + ' with an assist from ' + assister.name, null, 0xFF0000,   'bold')
            } else {
                room.sendAnnouncement('😔 | Broski ' + goalscorer.name + ' be scorin a own goal', null, 0xFF0000, 'bold')
            }
            team == 1 ? kicks[0]++ : kicks[1]++
        }
    }

    room.onTeamVictory = function(scores) {
        goals = [scores.red, scores.blue]
        let totalPoss = kicks[0] + kicks[1]
        poss = [(kicks[0] * 100) / totalPoss, (kicks[1] * 100) / totalPoss]

        room.sendAnnouncement(`💯 | SCORE:\nred: ${goals[0]} | blue: ${goals[1]}\n📊 | POSSESSION:\nred: ${poss[0]}% | blue: ${poss[1]}%\n⚽️ | KICKS:\nred: ${kicks[0]} | blue: ${kicks[1]}`, null, 0xFFFFF00, 'bold')

        scores.red == 0 ? room.sendAnnouncement('🥅 | The BLUE goalkeeper kept a clean sheet!', null, 0xFFFFF00, 'bold') : {}
        scores.blue == 0 ? room.sendAnnouncement('🥅 | The RED goalkeeper kept a clean sheet!', null, 0xFFFFF00, 'bold') : {}
    }

    room.onRoomLink = function(link) {
        console.log(link)
    }
});

let jsonFile = fs.readFileSync('token.json');
let jsonVar = JSON.parse(jsonFile);
client.login(jsonVar.discord.token);